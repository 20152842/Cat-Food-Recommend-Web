<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>냥이 사료 추천기 🐱</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-emoji">🐱</div>
            <h1>냥이 사료 추천기</h1>
            <p class="subtitle">우리 고양이에게 딱 맞는 사료를 찾아드려요</p>
            <p class="description">미국반려동물협회(NRC/AAFCO) 공인 칼로리 계산 공식으로 필요한 영양량을 정확히 계산하고, 예산에 맞는 최적의 사료를 추천해 드립니다.</p>
        </header>

        <main>
            <!-- 입력 폼 -->
            <section class="input-section">
                <h2>고양이 정보 입력</h2>

                <!-- 체중 -->
                <div class="input-group">
                    <label for="weightKg">몸무게 (kg)</label>
                    <div class="input-with-unit">
                        <input type="number" id="weightKg" min="0.1" max="20" step="0.1" placeholder="예: 4.0" required>
                        <span class="unit">kg</span>
                    </div>
                    <span class="helper-text">0.1 ~ 20kg 사이로 입력해주세요</span>
                </div>

                <!-- 나이 -->
                <div class="input-group">
                    <label>나이</label>
                    <div class="age-container">
                        <div class="input-with-unit">
                            <input type="number" id="ageYears" min="0" max="25" placeholder="0" value="0">
                            <span class="unit">살</span>
                        </div>
                        <span class="age-separator">+</span>
                        <div class="input-with-unit">
                            <input type="number" id="ageMonthsExtra" min="0" max="11" placeholder="0" value="0">
                            <span class="unit">개월</span>
                        </div>
                    </div>
                    <span class="helper-text" id="ageHelperText">총 0개월 (최소 1개월 이상)</span>
                </div>

                <!-- 성별 -->
                <div class="input-group">
                    <label>성별</label>
                    <div class="radio-group">
                        <label class="radio-card">
                            <input type="radio" name="gender" value="MALE">
                            <span class="radio-label">
                                <span class="radio-emoji">♂</span>
                                수컷
                            </span>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="gender" value="FEMALE">
                            <span class="radio-label">
                                <span class="radio-emoji">♀</span>
                                암컷
                            </span>
                        </label>
                    </div>
                </div>

                <!-- 중성화 여부 -->
                <div class="input-group">
                    <label>중성화 여부</label>
                    <div class="radio-group">
                        <label class="radio-card">
                            <input type="radio" name="neutered" value="true">
                            <span class="radio-label">
                                <span class="radio-emoji">✂️</span>
                                중성화 했어요
                            </span>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="neutered" value="false">
                            <span class="radio-label">
                                <span class="radio-emoji">🐾</span>
                                안 했어요
                            </span>
                        </label>
                    </div>
                </div>

                <!-- 월 예산 -->
                <div class="input-group">
                    <label for="monthlyBudget">월 예산 (원)</label>
                    <div class="input-with-unit">
                        <input type="number" id="monthlyBudget" min="1000" max="1000000" step="1000" placeholder="예: 50000" required>
                        <span class="unit">원</span>
                    </div>
                    <span class="helper-text" id="budgetHelperText">입력 후 하루 예산이 표시됩니다</span>
                </div>

                <!-- 검색어 (선택) -->
                <div class="input-group">
                    <label for="searchQuery">검색어 (선택)</label>
                    <div class="input-with-unit search-query-wrap">
                        <input type="text" id="searchQuery" class="search-query-input" placeholder="비워두면 고양이/키튼/시니어 등 자동 검색">
                    </div>
                </div>
                <p id="apiUnavailableNote" class="api-unavailable hidden">네이버 쇼핑 API가 설정되지 않았습니다. 검색 결과를 받으려면 서버 설정이 필요합니다.</p>
            </section>

            <!-- 예시 버튼 -->
            <section class="preset-section">
                <h2>🐾 예시 입력</h2>
                <div class="preset-buttons">
                    <button class="preset-btn" data-preset="adult-neutered">4kg 중성화 수컷 성체 (3살)</button>
                    <button class="preset-btn" data-preset="kitten">1.5kg 성장기 키튼 (5개월)</button>
                    <button class="preset-btn" data-preset="senior">5kg 노령 암컷 (10살)</button>
                </div>
            </section>

            <!-- 추천 버튼 -->
            <div class="action-section">
                <button id="recommendBtn" class="recommend-btn">🔍 사료 추천받기</button>
                <p class="helper-text" style="text-align: center; margin-top: 10px; color: #888;">
                    Enter 키를 눌러도 추천받을 수 있어요
                </p>
            </div>

            <!-- 에러 메시지 -->
            <div id="errorMessage" class="error-message hidden"></div>

            <!-- 결과 섹션 -->
            <section id="resultSection" class="result-section hidden">
                <h2>🍽️ 추천 결과</h2>

                <!-- 칼로리 정보 (간단 표시) -->
                <div class="calorie-compact">
                    <span class="calorie-inline">권장 일일 칼로리: <strong id="dailyCalories">-</strong> kcal</span>
                    <button type="button" class="calorie-detail-btn" id="calorieDetailBtn">자세히</button>
                    <div id="calorieDetailPanel" class="calorie-detail-panel hidden">
                        <div class="calorie-detail-line">
                            <span id="lifeStageDesc" class="life-stage-badge"></span>
                            <span class="calorie-sub">RER: <strong id="rerCalories">-</strong> kcal × 계수 <strong id="lifeFactor">-</strong></span>
                        </div>
                        <div class="calorie-detail-buttons">
                            <button type="button" class="formula-toggle" id="formulaToggle">📐 계산식</button>
                            <button type="button" class="formula-toggle source-toggle" id="sourceToggle">📋 계산 근거·출처</button>
                        </div>
                        <div class="formula-content hidden" id="formulaContent"><pre id="formulaText"></pre></div>
                        <div class="formula-content hidden" id="sourceContent"><pre id="sourceText"></pre></div>
                    </div>
                </div>

                <!-- 정렬 선택 (한 번에 하나만 표시) -->
                <div id="sortSection" class="sort-section hidden">
                    <span class="sort-label">보기 기준:</span>
                    <div class="sort-buttons">
                        <button type="button" class="sort-btn active" data-sort="rank">랭킹순</button>
                        <button type="button" class="sort-btn" data-sort="price">가격순</button>
                        <button type="button" class="sort-btn" data-sort="review">리뷰순</button>
                    </div>
                    <p id="reviewSortNote" class="sort-note hidden"></p>
                </div>

                <!-- 추천 없음 / API 미설정 안내 -->
                <div id="noResultBox" class="no-result-box hidden">
                    <span class="no-result-emoji">😿</span>
                    <p id="noResultMessage">검색 결과가 없습니다. 검색어를 바꿔 보세요.</p>
                </div>

                <!-- 추천 사료 카드 목록 (선택한 기준에 따라 하나만 표시) -->
                <div id="recommendationsList" class="recommendations-list"></div>
            </section>

            <!-- 비교 목록 (최대 5개, 2개부터 표시) -->
            <section id="compareSection" class="compare-section">
                <h2>📊 비교 목록</h2>
                <p class="compare-desc">추천 결과에서 제품을 선택해 추가한 뒤, 포장지·쇼핑몰에서 확인한 <strong>정확한 정보</strong>를 입력하면 비교할 수 있습니다. (최대 5개)</p>
                <div id="compareList" class="compare-list"></div>
                <div id="compareTableWrap" class="compare-table-wrap hidden">
                    <h3>제품 비교</h3>
                    <table id="compareTable" class="compare-table"></table>
                </div>
            </section>
        </main>

        <footer>
            <p>냥이 사료 추천기 | NRC/AAFCO 칼로리 계산 공식 기반 | 실제 구매 전 수의사와 상담을 권장합니다</p>
        </footer>
    </div>

    <script th:src="@{/js/app.js(v=1)}"></script>
</body>
</html>
